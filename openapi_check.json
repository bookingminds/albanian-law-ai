{"openapi":"3.1.0","info":{"title":"Albanian Law AI","description":"RAG-based legal document Q&A for Albanian law","version":"2.0.0"},"paths":{"/":{"get":{"summary":"Serve Landing","operationId":"serve_landing__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/app":{"get":{"summary":"Serve Chat","operationId":"serve_chat_app_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/pricing":{"get":{"summary":"Serve Pricing","operationId":"serve_pricing_pricing_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/admin":{"get":{"summary":"Serve Admin","operationId":"serve_admin_admin_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/login":{"get":{"summary":"Serve Login","operationId":"serve_login_login_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/documents":{"get":{"summary":"Serve Documents","operationId":"serve_documents_documents_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/register":{"post":{"summary":"Register","description":"Register a new user. Uses Supabase Auth if configured, else local.","operationId":"register_api_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/login":{"post":{"summary":"Login","description":"Login. Uses Supabase Auth if configured, else local.","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/forgot-password":{"post":{"summary":"Forgot Password","description":"Send a password reset email via Supabase Auth.","operationId":"forgot_password_api_auth_forgot_password_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ForgotPasswordRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/logout":{"post":{"summary":"Logout","description":"Server-side logout: revoke Supabase session.","operationId":"logout_api_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/auth/me":{"get":{"summary":"Auth Me","description":"Return current user, subscription status, and trial info.","operationId":"auth_me_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/subscription/status":{"get":{"summary":"Subscription Status","operationId":"subscription_status_api_subscription_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/subscription/verify-google-play":{"post":{"summary":"Verify Google Play Purchase","description":"Verify a Google Play subscription purchase and activate it.\n\nUses Google Play Developer API for server-side verification when\nGOOGLE_PLAY_SERVICE_ACCOUNT_JSON is configured. Falls back to\nclient-trust mode for development/testing.","operationId":"verify_google_play_purchase_api_subscription_verify_google_play_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GooglePlayVerifyRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/subscription/restore":{"post":{"summary":"Restore Purchase","description":"Check if user has an active subscription (for restore purchase flow).","operationId":"restore_purchase_api_subscription_restore_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/user/documents/upload":{"post":{"summary":"User Upload Document","description":"Upload a document. Only admin can upload documents.","operationId":"user_upload_document_api_user_documents_upload_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_user_upload_document_api_user_documents_upload_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/user/documents":{"get":{"summary":"List User Documents","description":"List all documents belonging to admin. Only admin can view.","operationId":"list_user_documents_api_user_documents_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/user/documents/ready":{"get":{"summary":"List User Ready Documents","description":"List only ready documents for dropdown filter. Admin only.","operationId":"list_user_ready_documents_api_user_documents_ready_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/user/documents/{doc_id}":{"delete":{"summary":"User Delete Document","description":"Delete a document. Admin only.","operationId":"user_delete_document_api_user_documents__doc_id__delete","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/documents/{doc_id}/retry":{"post":{"summary":"User Retry Document","description":"Retry processing a failed document. Admin only.","operationId":"user_retry_document_api_user_documents__doc_id__retry_post","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/documents/{doc_id}/rename":{"patch":{"summary":"User Rename Document","description":"Rename a document's title (only if it belongs to the user).","operationId":"user_rename_document_api_user_documents__doc_id__rename_patch","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RenameRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/documents/{doc_id}/pdf":{"get":{"summary":"Serve User Document Pdf","description":"Serve the original PDF file for viewing. Admin only.\nAccepts token via Bearer header or ?token= query param for new-tab viewing.","operationId":"serve_user_document_pdf_api_user_documents__doc_id__pdf_get","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/documents/upload":{"post":{"summary":"Upload Document","description":"Upload a legal document (admin only). Assigned to admin's user_id.","operationId":"upload_document_api_documents_upload_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_document_api_documents_upload_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/documents":{"get":{"summary":"List Documents","description":"List all uploaded documents (admin view).","operationId":"list_documents_api_documents_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/documents/{doc_id}":{"get":{"summary":"Get Document Detail","operationId":"get_document_detail_api_documents__doc_id__get","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Remove Document","operationId":"remove_document_api_documents__doc_id__delete","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat":{"post":{"summary":"Chat","description":"Ask a question â hybrid RAG pipeline.\n\nAdmin: searches their own documents.\nNormal user: searches all ready documents globally (knowledge base).","operationId":"chat_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/chat/history/{session_id}":{"get":{"summary":"Get Chat History Endpoint","operationId":"get_chat_history_endpoint_api_chat_history__session_id__get","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/suggest-topics":{"get":{"summary":"Suggest Topics Endpoint","description":"Return precomputed topic index for client-side instant matching.","operationId":"suggest_topics_endpoint_api_suggest_topics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/suggest-questions":{"post":{"summary":"Suggest Questions","description":"Ultra-fast grounded suggestions â NO LLM.\n\nPipeline (<300ms target):\n1. Cache check â 0ms\n2. Single vector search k=12 â ~150-350ms\n3. Deterministic template build â ~1ms","operationId":"suggest_questions_api_suggest_questions_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuggestRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/suggested-questions":{"get":{"summary":"Get Suggested Questions Api","description":"Public: return active questions grouped by category.","operationId":"get_suggested_questions_api_api_suggested_questions_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/admin/suggested-questions":{"get":{"summary":"Admin List Suggested Questions","description":"Admin: list all questions (active + inactive).","operationId":"admin_list_suggested_questions_api_admin_suggested_questions_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]},"post":{"summary":"Admin Create Suggested Question","operationId":"admin_create_suggested_question_api_admin_suggested_questions_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/admin/suggested-questions/{qid}":{"patch":{"summary":"Admin Update Suggested Question","operationId":"admin_update_suggested_question_api_admin_suggested_questions__qid__patch","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"qid","in":"path","required":true,"schema":{"type":"integer","title":"Qid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Admin Delete Suggested Question","operationId":"admin_delete_suggested_question_api_admin_suggested_questions__qid__delete","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"qid","in":"path","required":true,"schema":{"type":"integer","title":"Qid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/promote":{"post":{"summary":"Promote To Admin","description":"One-time admin promotion secured by JWT_SECRET.","operationId":"promote_to_admin_api_admin_promote_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health":{"get":{"summary":"Health Check","operationId":"health_check_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"summary":"Health Check","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health/detailed":{"get":{"summary":"Health Check Detailed","operationId":"health_check_detailed_api_health_detailed_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/debug/search":{"post":{"summary":"Debug Search","description":"Test vector search with user-scoped filtering. Admin-only.","operationId":"debug_search_api_debug_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DebugSearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/debug/store-stats":{"get":{"summary":"Debug Store Stats","operationId":"debug_store_stats_api_debug_store_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}]}},"/api/debug/reprocess/{doc_id}":{"post":{"summary":"Debug Reprocess","description":"Re-process a document (delete old chunks from both stores). Admin-only.","operationId":"debug_reprocess_api_debug_reprocess__doc_id__post","security":[{"HTTPBearer":[]},{"APIKeyCookie":[]}],"parameters":[{"name":"doc_id","in":"path","required":true,"schema":{"type":"integer","title":"Doc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_upload_document_api_documents_upload_post":{"properties":{"file":{"type":"string","contentMediaType":"application/octet-stream","title":"File"},"title":{"type":"string","title":"Title"},"law_number":{"type":"string","title":"Law Number"},"law_date":{"type":"string","title":"Law Date"}},"type":"object","required":["file"],"title":"Body_upload_document_api_documents_upload_post"},"Body_user_upload_document_api_user_documents_upload_post":{"properties":{"file":{"type":"string","contentMediaType":"application/octet-stream","title":"File"},"title":{"type":"string","title":"Title"}},"type":"object","required":["file"],"title":"Body_user_upload_document_api_user_documents_upload_post"},"ChatRequest":{"properties":{"question":{"type":"string","title":"Question"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"},"document_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Document Id"},"debug":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Debug","default":false},"stream":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Stream","default":false}},"type":"object","required":["question"],"title":"ChatRequest"},"DebugSearchRequest":{"properties":{"query":{"type":"string","title":"Query"},"top_k":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Top K"},"document_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Document Id"}},"type":"object","required":["query"],"title":"DebugSearchRequest"},"ForgotPasswordRequest":{"properties":{"email":{"type":"string","title":"Email"}},"type":"object","required":["email"],"title":"ForgotPasswordRequest"},"GooglePlayVerifyRequest":{"properties":{"purchase_token":{"type":"string","title":"Purchase Token"},"product_id":{"type":"string","title":"Product Id"},"package_name":{"type":"string","title":"Package Name","default":"com.zagrid.albanianlawai"}},"type":"object","required":["purchase_token","product_id"],"title":"GooglePlayVerifyRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"email":{"type":"string","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"LoginRequest"},"RegisterRequest":{"properties":{"email":{"type":"string","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"RegisterRequest"},"RenameRequest":{"properties":{"title":{"type":"string","title":"Title"}},"type":"object","required":["title"],"title":"RenameRequest"},"SuggestRequest":{"properties":{"partial":{"type":"string","title":"Partial"},"document_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Document Id"}},"type":"object","required":["partial"],"title":"SuggestRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"},"input":{"title":"Input"},"ctx":{"type":"object","title":"Context"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"},"APIKeyCookie":{"type":"apiKey","in":"cookie","name":"token"}}}}
